---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import AnimateOnScroll from '../components/AnimateOnScroll.astro';

const latestArticles = (await getCollection('docs'))
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 3);

// Placeholder for featured projects
const featuredProjects = [
  {
    title: "Modaryn",
    description: "modaryn analyzes dbt projects to score model complexity and structural importance, helping teams identify high-risk and high-impact data models.",
    link: "https://github.com/yujikawa/modaryn"
  }
];
---

<Layout title="Welcome!">
  <main class="min-h-screen pt-16 pb-12">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-6xl">

      <!-- Hero Section -->
      <section class="text-center py-16 md:py-24 animate-fade-in-up">
        <h1 class="text-5xl md:text-6xl font-extrabold text-text-base mb-4 leading-tight">
          Welcome to <span class="text-secondary">my page</span>
        </h1>
        <img
          class="mx-auto h-32 w-32 rounded-full shadow-lg border-4 border-primary transition-transform duration-300 hover:scale-105 mb-6"
          src="/mypage/icon.png"
          alt="Profile picture"
        />

        <p class="text-xl text-text-muted max-w-3xl mx-auto mb-8">
          I work as an Analytics Engineer in Japan, and I'm dedicated to writing articles and developing projects related to Analytics Engineering.
        </p>
      </section>

      <!-- GitHub Contributions Chart Section -->
      <AnimateOnScroll animation="slide-up" delay={200}>
        <section class="bg-background-alt py-8 px-6 rounded-lg shadow-xl border border-border-color mt-12 mb-12">
          <h2 class="text-3xl font-bold text-text-base mb-6 text-center">Activity Overview</h2>
          <img
            class="mx-auto w-full max-w-xl rounded-lg shadow-md transition-transform duration-300 hover:scale-105"
            src="https://ghchart.rshah.org/yujikawa"
            alt="GitHub Contributions Chart"
          />
          <p class="mt-4 text-center text-xs text-text-muted">
            <small>This chart is generated by the <a href="https://ghchart.rshah.org/" target="_blank" rel="noopener noreferrer" class="text-secondary hover:underline transition-colors duration-200">ghchart API</a>.</small>
          </p>
        </section>
      </AnimateOnScroll>

      <!-- Latest Articles Section -->
      <AnimateOnScroll animation="slide-up" delay={400}>
        <section class="bg-background-alt py-8 px-6 rounded-lg shadow-xl border border-border-color mt-12 mb-12">
          <h2 class="text-3xl font-bold text-text-base mb-6 text-center">Latest Articles</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {latestArticles.length === 0 ? (
              <p class="text-center col-span-full text-text-muted">No articles found.</p>
            ) : (
              latestArticles.map((article) => (
                <a href={`/mypage/docs/${article.slug}`} class="block bg-background p-6 rounded-lg shadow-md border border-border-color transition-all duration-300 transform hover:-translate-y-1 hover:shadow-xl">
                  <h4 class="text-xl font-semibold text-primary mb-2">{article.data.title}</h4>
                  {article.data.description && <p class="text-text-muted text-sm">{article.data.description}</p>}
                </a>
              ))
            )}
          </div>
          <div class="mt-8 text-center">
            <a
              href="/mypage/docs"
              class="inline-flex items-center px-6 py-3 border border-primary text-base font-medium rounded-md shadow-sm text-primary bg-transparent hover:bg-primary hover:text-background transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 -ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <span>View All Articles</span>
            </a>
          </div>
        </section>
      </AnimateOnScroll>

      <!-- Featured Projects Section -->
      <AnimateOnScroll animation="slide-up" delay={600}>
        <section class="bg-background-alt py-8 px-6 rounded-lg shadow-xl border border-border-color mt-12 mb-12">
          <h2 class="text-3xl font-bold text-text-base mb-6 text-center">Featured Projects</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {featuredProjects.map((project) => (
              <a href={project.link} target="_blank" rel="noopener noreferrer" class="block bg-background p-6 rounded-lg shadow-md border border-border-color transition-all duration-300 transform hover:-translate-y-1 hover:shadow-xl">
                <h4 class="text-xl font-semibold text-primary mb-2">{project.title}</h4>
                <p class="text-text-muted text-sm">{project.description}</p>
              </a>
            ))}
          </div>
        </section>
      </AnimateOnScroll>

    </div>
  </main>
</Layout>